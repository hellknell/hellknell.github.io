{"version":3,"file":"js/164.854530c9.js","mappings":"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","sources":["webpack://web/./src/util/request.js","webpack://web/./src/views/main/OrderView.vue","webpack://web/./src/views/main/OrderView.vue?630d"],"sourcesContent":["import axios from 'axios'\r\nimport store from \"@/store\";\r\nimport {notification} from \"ant-design-vue\";\r\nimport router from \"@/router\";\r\n\r\n// 创建可一个新的axios对象\r\nconst request = axios.create({\r\n    baseURL: process.env.VUE_APP_BASEURL,   // 后端的接口地址  ip:port\r\n    timeout: 30000                          // 30s请求超时\r\n})\r\n\r\n// request 拦截器\r\n// 可以自请求发送前对请求做一些处理\r\n// 比如统一加token，对请求参数统一加密\r\nrequest.interceptors.request.use(config => {\r\n    config.headers['Content-Type'] = 'application/json;charset=utf-8';\r\n    let token = JSON.parse(localStorage.getItem('member')) || undefined;\r\n    config.headers.token = token?.token;\r\n    return config\r\n}, error => {\r\n    console.error('request error: ' + error) // for debug\r\n    return Promise.reject(error)\r\n});\r\n\r\n// response 拦截器\r\n// 可以在接口响应后统一处理结果\r\nrequest.interceptors.response.use(\r\n    response => {\r\n        let res = response.data;\r\n        if (res.code === '401') {\r\n            store.commit(\"setMember\", {});\r\n            notification.error({\r\n                message: '错误',\r\n                description: '登录已过期，请重新登录',\r\n            })\r\n            router.push('/login')\r\n        }\r\n        // 兼容服务端返回的字符串数据\r\n        if (typeof res === 'string') {\r\n            res = res ? JSON.parse(res) : res\r\n        }\r\n        return res;\r\n    },\r\n    error => {\r\n        console.log('返回错误：', error);\r\n        const response = error.response;\r\n        const status = response.status;\r\n        if (status === 401) {\r\n            // 判断状态码是401 跳转到登录页\r\n            console.log(\"未登录或登录超时，跳到登录页\");\r\n            store.commit(\"setMember\", {});\r\n            notification.error({ description: \"未登录或登录超时\" });\r\n            router.push('/login');\r\n        }\r\n        return Promise.reject(error);\r\n    }\r\n)\r\n\r\nexport default request","<template>\r\n  <div class=\"order\" style=\"width: 100%;padding: 10px\">\r\n    <a-card hoverable style=\"margin: 0 auto;padding: 10px\">\r\n      <template #title>\r\n        <div style=\"text-align: left;font-weight: bold;text-indent: 30px\">\r\n          列车信息 （以下余票信息仅供参考)\r\n        </div>\r\n      </template>\r\n      <template #cover>\r\n        <a-row justify=\"start\" type=\"flex\" align=\"middle\"\r\n               style=\"height:40px;border-bottom: 1px dashed #000;font-size:20px;font-weight: bold;width: 98%;margin: 0 auto\">\r\n          <a-col style=\"padding-left:5px \" :span=\"4\">{{ dailyTickets.date }}&nbsp;(周{{ number }})</a-col>\r\n          <a-col :span=\"3\">{{ dailyTickets.trainCode }}<span style=\"font-size: 13px;color: rgba(0,0,0,0.7)\">次</span>\r\n          </a-col>\r\n          <a-col :span=\"10\"><span>{{ dailyTickets.start }}</span> ({{ dailyTickets.startTime }}开)&nbsp; &nbsp; &nbsp;\r\n            &nbsp;---&nbsp; &nbsp; &nbsp; &nbsp; {{ dailyTickets.end }}({{ dailyTickets.endTime }}到)\r\n          </a-col>\r\n        </a-row>\r\n        <a-row justify=\"start\" type=\"flex\" align=\"middle\"\r\n               style=\"height:40px;font-size:13px;font-weight: bold;width: 98%;margin: 0 auto\">\r\n          <a-col v-if=\"dailyTickets.ydz>=0\" style=\"padding-left:5px \" :span=\"4\">一等座(<span style=\"color: orangered\">￥ {{\r\n              dailyTickets.ydzPrice\r\n            }}</span>)<span\r\n              v-if=\"dailyTickets.ydz<20\">&nbsp;{{ dailyTickets.ydz }}张票</span>\r\n            <span v-else>&nbsp;有票</span></a-col>\r\n          <a-col v-if=\"dailyTickets.edz>=0\" style=\"padding-left:5px \" :span=\"4\">二等座(<span style=\"color: orangered\">￥ {{\r\n              dailyTickets.edzPrice\r\n            }}</span>)<span\r\n              v-if=\"dailyTickets.edz<20\">&nbsp;{{ dailyTickets.edz }}张票</span>\r\n            <span v-else>&nbsp;有票</span></a-col>\r\n          <a-col v-if=\"dailyTickets.yw>=0\" style=\"padding-left:5px \" :span=\"4\">硬卧(<span\r\n              style=\"color: orangered\">￥ {{ dailyTickets.ywPrice }}</span>)<span\r\n              v-if=\"dailyTickets.yw<20\">&nbsp;{{ dailyTickets.yw }}张票</span>\r\n            <span v-else>&nbsp;有票</span></a-col>\r\n          <a-col v-if=\"dailyTickets.rw>=0\" style=\"padding-left:5px \" :span=\"4\">软卧(<span\r\n              style=\"color: orangered\">￥ {{ dailyTickets.rwPrice }}</span>)<span\r\n              v-if=\"dailyTickets.rw<20\">&nbsp;{{ dailyTickets.rw }}张票</span>\r\n            <span v-else>&nbsp;有票</span></a-col>\r\n\r\n        </a-row>\r\n        <a-divider></a-divider>\r\n\r\n        <a-checkbox-group v-model:value=\"passengerChecks\">\r\n          <a-row :gutter=\"1\">\r\n            <span style=\"font-weight: bold\">请勾选要购票的乘客:</span>\r\n            <a-col :span=\"4\" v-for=\"item in passengerOption\" :key=\"item.id\" :value=\"item.value\">\r\n              <a-checkbox style=\"font-size: 16px\" :value=\"item.value\">{{ item.label }}</a-checkbox>\r\n            </a-col>\r\n          </a-row>\r\n        </a-checkbox-group>\r\n        <a-row justify=\"center\" type=\"flex\" align=\"middle\" :gutter=\"10\" v-if=\"tickets.length>0\"\r\n               style=\"margin: 20px auto 0;  border: solid 1px cornflowerblue;;background: linear-gradient(to right, #4facfe, #00f2fe);height: 40px;font-size:18px;\">\r\n          <a-col :span=\"2\">乘客</a-col>\r\n          <a-col :span=\"6\">身份证</a-col>\r\n          <a-col :span=\"4\">票种</a-col>\r\n          <a-col :offset=\"1\" :span=\"3\">座位类型</a-col>\r\n        </a-row>\r\n        <a-row type=\"flex\" justify=\"center\" align=\"top\"\r\n               style=\"  border: solid 1px cornflowerblue;margin:0 auto;font-size: 16px\" :gutter=\"10\"\r\n               v-for=\"ticket in tickets\" :key=\"ticket.id\">\r\n          <a-col :offset=\"1\" :span=\"2\">{{ ticket.passengerName }}</a-col>\r\n          <a-col :span=\"6\">{{ ticket.passengerIdCard }}</a-col>\r\n          <a-col :span=\"4\">\r\n            <a-select style=\"width: 100%;\" v-model:value=\"ticket.passengerType\">\r\n              <a-select-option v-for=\"item in PassengerType\" :key=\"item.code\" :value=\"item.code\">\r\n                {{ item.desc }}\r\n              </a-select-option>\r\n            </a-select>\r\n          </a-col>\r\n          <a-col :offset=\"1\" :span=\"4\">\r\n            <a-radio-group v-model:value=\"ticket.seatTypeCode\" name=\"radioGroup\">\r\n              <a-radio v-for=\"item in seatTypes\" :key=\"item.code\" :value=\"item.code\">{{ item.desc }}</a-radio>\r\n            </a-radio-group>\r\n          </a-col>\r\n        </a-row>\r\n      </template>\r\n    </a-card>\r\n    <a-divider/>\r\n    <div style=\"display: flex;justify-content: flex-start\" v-if=\"tickets.length>0\">\r\n      <a-button type=\"primary\" size=\"large\" :loading=\"flag\" @click=\"onConfirm\">{{\r\n          flag ? '正在生成订单' : '确认订单'\r\n        }}\r\n      </a-button>\r\n    </div>\r\n    {{ tickets.value }}\r\n    <a-drawer\r\n        size=\"large\"\r\n        title=\"请核对以下信息\"\r\n        placement=\"bottom\"\r\n        :closable=\"true\"\r\n        :visible=\"visible\"\r\n        @close=\"onClose\"\r\n    >\r\n      <div style=\"width:70%;margin: 0 auto\">\r\n        <a-table align=\"center\" bordered\r\n                 :row-class-name=\"(_record, index) => (index % 2 === 1 ? 'table-striped' : null)\"\r\n                 :data-source=\"tickets\"\r\n                 :columns=\"columns\" :pagination=\"false\" :customHeaderRow=\"customRow\">\r\n          <template #headerCell=\"{title, column}\">\r\n            <template v-if=\"column.dataIndex==='passengerType'\">\r\n              <span>{{ title }}\r\n                <a-tooltip>\r\n                  <template #title>\r\n                    <span>乘客类型</span>\r\n                  </template>\r\n                  <question-circle-outlined/>\r\n                </a-tooltip>\r\n              </span>\r\n            </template>\r\n          </template>\r\n          <template #bodyCell=\"{ column, record }\">\r\n            <template v-if=\"column.dataIndex==='passengerType'\">\r\n          <span v-for=\"item in PassengerType\" :key=\"item.code\">\r\n            <span v-if=\"item.code===record.passengerType\">{{ item.desc }}</span>\r\n          </span>\r\n            </template>\r\n            <template v-if=\"column.dataIndex==='seatTypeCode'\">\r\n  <span v-for=\"item in SEATTYPE\" :key=\"item.code\">\r\n            <span v-if=\"item.code===record.seatTypeCode\">{{ item.desc }}</span>\r\n          </span>\r\n            </template>\r\n          </template>\r\n        </a-table>\r\n\r\n        <div v-if=\"chooseSeatCode=== '0'\" style=\"color: red;font-size: 18px;margin-top: 20px;width: max-content\">\r\n          很抱歉,您购买的车票不支持选座\r\n          <div>12306规则：只有全部是一等座或全部是二等座才支持选座</div>\r\n          <div>12306规则：余票小于一定数量时，不允许选座（本项目以20为例）</div>\r\n        </div>\r\n        <div v-else\r\n             style=\"display: flex;text-align: center;width: 100%;margin: 20px auto;align-items: center;gap: 20px;flex-direction: column\">\r\n          <div style=\"flex: 4\">\r\n            <a-switch class=\"choose-seat-item\" size=\"large\" v-for=\"seat in SEAT_COL\" :key=\"seat.code\"\r\n                      :checked-children=\"seat.desc\"\r\n                      :un-checked-children=\"seat.desc\" v-model:checked=\"chooseSeatObj[seat.code+1]\">\r\n            </a-switch>\r\n          </div>\r\n          <div style=\"flex: 4;\" v-if=\"tickets.length>1\">\r\n            <a-switch class=\"choose-seat-item\" size=\"large\" v-for=\"seat in SEAT_COL\" :key=\"seat.code\"\r\n                      :checked-children=\"seat.desc\"\r\n                      :un-checked-children=\"seat.desc\" v-model:checked=\"chooseSeatObj[seat.code+2]\">\r\n            </a-switch>\r\n          </div>\r\n          <span style=\"position: relative;bottom: 10px\">提示:你可以选择{{ tickets.length }}个座位</span>\r\n        </div>\r\n      </div>\r\n      <template #extra>\r\n        <a-space>\r\n          <a-button @click=\"onClose\">取消</a-button>\r\n          <a-button type=\"primary\" @click=\"showCode\">确认</a-button>\r\n        </a-space>\r\n      </template>\r\n    </a-drawer>\r\n  </div>\r\n  <a-modal v-model:visible=\"imgVisible\" style=\"border-radius: 10px;height: 40%!important;\" :footer=\"null\"\r\n           title=\"防瞬时高峰验证码\">\r\n    <a-form ref=\"imgCodeRef\" :rules=\"rules\" :model=\"form\">\r\n      <a-form-item   name=\"imgCode\">\r\n        <a-input placeholder=\"请输入验证码\" v-model:value=\"form.imgCode\">\r\n          <template #suffix>\r\n            <img :src=\"imgCodeUrl\" alt=\"\" @click=\"loadImgCode\">\r\n          </template>\r\n        </a-input>\r\n      </a-form-item>\r\n      <a-form-item>\r\n        <a-button html-type=\"submit\" style=\"width: 100%;margin-top:20px;\" type=\"primary\" danger @click=\"handleOk\">确认\r\n        </a-button>\r\n      </a-form-item>\r\n\r\n    </a-form>\r\n\r\n  </a-modal>\r\n\r\n</template>\r\n\r\n<script setup>\r\n\r\nimport dayjs from \"dayjs\";\r\nimport {computed, onMounted, reactive, ref, watch} from \"vue\";\r\nimport request from \"@/util/request\";\r\nimport {PASSAGER_TYPE_ARRAY, SEAT_COL_ARRAY, TrainSeat_TYPE_ARRAY} from \"@/assets/js/enum\";\r\nimport {notification} from \"ant-design-vue\";\r\n\r\nconst imgCodeRef = ref()\r\nconst form = reactive(({\r\n  imgCode: undefined\r\n}))\r\nconst imgToken = ref()\r\nconst imgCodeUrl = ref()\r\nconst imgVisible = ref(false)\r\nconst dailyTickets = SESSION.get(SESSINO_ORDER);\r\nconst PassengerType = PASSAGER_TYPE_ARRAY\r\nconst SEATTYPE = TrainSeat_TYPE_ARRAY\r\nconst passenger = ref([])\r\nconst passengerOption = ref([])\r\nconst passengerChecks = ref([])\r\nlet number = dayjs(dailyTickets.date, 'YYYY-MM-DD').day();\r\nconst visible = ref(false)\r\nconst flag = ref(false)\r\nconst tickets = ref([])\r\nwatch(() => passengerChecks.value, () => {\r\n  tickets.value = []\r\n  passengerChecks.value.forEach(item => tickets.value.push({\r\n    passengerId: item.id,\r\n    passengerName: item.name,\r\n    passengerType: item.type,\r\n    passengerIdCard: item.idCard,\r\n    seatTypeCode: \"1\"\r\n  }))\r\n}, {immediate: true})\r\n\r\nconst seatTypes = ref([])\r\nfor (let KEY in SEATTYPE) {\r\n  let key = KEY.toLowerCase();\r\n  if (dailyTickets[key] >= 0) {\r\n    seatTypes.value.push({\r\n      type: key,\r\n      code: SEATTYPE[KEY][\"code\"],\r\n      desc: SEATTYPE[KEY][\"desc\"],\r\n      count: dailyTickets[key],\r\n      price: dailyTickets[key + 'Price'],\r\n    })\r\n  }\r\n}\r\n\r\nconst handleQuerypassenger = () => {\r\n  request.get(\"member/passenger/query-passenger-mine\").then(res => {\r\n    if (res.success) {\r\n      passenger.value = res.data\r\n      passenger.value.forEach(item => passengerOption.value.push({label: item.name, value: item}))\r\n    }\r\n  })\r\n}\r\nconst columns = ref([\r\n  {\r\n    title: '乘客',\r\n    dataIndex: 'passengerName',\r\n  },\r\n  {\r\n    title: '身份证',\r\n    dataIndex: 'passengerIdCard',\r\n\r\n  },\r\n  {\r\n    title: '票种',\r\n    dataIndex: 'passengerType',\r\n\r\n  },\r\n  {\r\n    title: '座位类型',\r\n    dataIndex: 'seatTypeCode',\r\n  }\r\n])//选择的座位类型,默认是无座\r\nconst chooseSeatCode = ref(\"0\")\r\nconst SEAT_COL = computed(() => {\r\n  return SEAT_COL_ARRAY.filter(item => item.type === chooseSeatCode.value)\r\n})\r\n//选座时两排座位\r\nconst chooseSeatObj = ref({});\r\nwatch(() => SEAT_COL.value, () => {\r\n  chooseSeatObj.value = {}\r\n  for (let i = 1; i <= 2; i++) {\r\n    SEAT_COL.value.forEach((item) => {\r\n      chooseSeatObj.value[item.code + i] = false;\r\n    })\r\n  }\r\n  console.log(\"初始化两排座位，都是未选中：\", chooseSeatObj.value);\r\n}, {immediate: true});\r\n\r\n\r\nconst onConfirm = () => {\r\n  if (tickets.value.length > 5) {\r\n    notification.error({description: '最多只能选择五个乘客'})\r\n    return\r\n  }\r\n  for (let i = 1; i <= 2; i++) {\r\n    SEAT_COL.value.forEach((item) => {\r\n      chooseSeatObj.value[item.code + i] = false;\r\n    })\r\n  }\r\n  let seatTempTypes = Tool.copy(seatTypes.value);\r\n  console.log(seatTempTypes)\r\n  for (let i = 0; i < tickets.value.length; i++) {\r\n    let Type = tickets.value[i];\r\n    seatTempTypes.filter(item => item.code === Type.seatTypeCode)[0].count--;\r\n    if (seatTempTypes.filter(item => item.code === Type.seatTypeCode)[0].count < 0) {\r\n      notification.error({description: seatTempTypes.filter(item => item.code === Type.seatTypeCode)[0].desc + '余票不足'})\r\n      return;\r\n    }\r\n  }\r\n  flag.value = true\r\n  setTimeout(() => {\r\n    flag.value = false\r\n    visible.value = true\r\n  }, 2000)\r\n  //只支持一等座或二等座选座\r\n  let seatTypeCodes = []\r\n  for (let i = 0; i < tickets.value.length; i++) {\r\n    seatTypeCodes.push(tickets.value[i].seatTypeCode)\r\n  }\r\n  let seatTypeDistinct = Array.from(new Set(seatTypeCodes))\r\n  if (seatTypeDistinct.length > 1) {\r\n    notification.error({description: '不支持选座'})\r\n    chooseSeatCode.value = \"0\"\r\n  } else {\r\n    if (seatTypeDistinct[0] === SEATTYPE.YDZ.code) {\r\n      console.log('一等座')\r\n      chooseSeatCode.value = SEATTYPE.YDZ.code\r\n    } else if (seatTypeDistinct[0] === SEATTYPE.EDZ.code) {\r\n      console.log('二等座')\r\n      chooseSeatCode.value = SEATTYPE.EDZ.code\r\n    } else {\r\n      notification.info({description: '不支持硬卧 | 软卧'})\r\n      chooseSeatCode.value = \"0\"\r\n    }\r\n  }\r\n  if (chooseSeatCode.value != \"0\") {\r\n    if (seatTypes.value.filter(item => item.code === chooseSeatCode.value)[0].count < 20) {\r\n      chooseSeatCode.value = \"0\"\r\n      // notification.error({description: '余票不足20,不支持选座'})\r\n    }\r\n  }\r\n}\r\nconst showCode = () => {\r\n  imgVisible.value = true;\r\n  loadImgCode()\r\n}\r\nconst handleOk = () => {\r\n  imgCodeRef.value.validateFields(['imgCode'])\r\n  console.log('重新选座')\r\n  for (let i = 0; i < tickets.value.length; i++) {\r\n    tickets.value[i].seat = null\r\n  }\r\n\r\n  let i = -1\r\n  for (let key in chooseSeatObj.value) {\r\n    if (chooseSeatObj.value[key]) {\r\n      i++;\r\n      if (i > tickets.value.length - 1) {\r\n        notification.error({description: '选座数超过余票数'})\r\n        return\r\n      }\r\n      tickets.value[i].seat = key\r\n    }\r\n  }\r\n  if (i > -1 && i < tickets.value.length - 1) {\r\n    notification.error({description: '选座数小于购票数'})\r\n    return\r\n  }\r\n  let confirmOrder = {\r\n    date: dailyTickets.date,\r\n    start: dailyTickets.start,\r\n    trainCode: dailyTickets.trainCode,\r\n    end: dailyTickets.end,\r\n    dailyTrainTicketId: dailyTickets.id,\r\n    tickets: tickets.value,\r\n    imgCode: form.imgCode,\r\n    imgToken: imgToken.value\r\n  }\r\n  request.post(\"business/confirm-order/do\", confirmOrder).then(res => {\r\n        // imgVisible.value = false\r\n    // if(res.code==='500117' ||  res.code==='500118'){\r\n    //\r\n    // }\r\n        if (res.success) {\r\n          notification.success({description: '选座成功'})\r\n          visible.value = false\r\n        } else {\r\n          notification.error({\r\n            description: res.msg\r\n          })\r\n        }\r\n      }\r\n  )\r\n}\r\nconst onClose = () => {\r\n  visible.value = false;\r\n}\r\nonMounted(() => {\r\n  handleQuerypassenger()\r\n})\r\nlet validateCode = async (_rule, value) => {\r\n  if (value === '') {\r\n    return Promise.reject('验证码为空');\r\n  }\r\n  return Promise.resolve();\r\n};\r\n\r\nconst rules = {\r\n  imgCode: [{\r\n    required: true,\r\n    validator: validateCode,\r\n    trigger: 'blur',\r\n  }]\r\n};\r\nconst loadImgCode = () => {\r\n  imgToken.value = Tool.uuid(8);\r\n  imgCodeUrl.value = process.env.VUE_APP_BASEURL + \"business/captcha/image-code/\" + imgToken.value\r\n}\r\n</script>\r\n<style scoped>\r\n/deep/ .ant-card-head-wrapper {\r\n  border-radius: 10px;\r\n}\r\n\r\n/deep/ .ant-card-head-wrapper {\r\n  background-color: rgba(95, 96, 93, 0.66) !important;\r\n}\r\n\r\n/deep/ .ant-card-head {\r\n  padding: 0;\r\n}\r\n\r\n.choose-seat-item {\r\n  margin: 10px 20px;\r\n  transform: scale(1.5);\r\n}\r\n\r\n[data-doc-theme='light'] .ant-table-striped :deep(.table-striped) td {\r\n  background-color: #fafafa;\r\n}\r\n\r\n[data-doc-theme='dark'] .ant-table-striped :deep(.table-striped) td {\r\n  background-color: rgb(29, 29, 29);\r\n}\r\n\r\n\r\n</style>","import script from \"./OrderView.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./OrderView.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./OrderView.vue?vue&type=style&index=0&id=29984de7&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-29984de7\"]])\n\nexport default __exports__"],"names":["request","axios","create","baseURL","process","timeout","interceptors","use","config","headers","token","JSON","parse","localStorage","getItem","undefined","error","console","Promise","reject","response","res","data","code","store","commit","notification","message","description","router","push","log","status","imgCodeRef","ref","form","reactive","imgCode","imgToken","imgCodeUrl","imgVisible","dailyTickets","SESSION","get","SESSINO_ORDER","PassengerType","PASSAGER_TYPE_ARRAY","SEATTYPE","TrainSeat_TYPE_ARRAY","passenger","passengerOption","passengerChecks","number","dayjs","date","day","visible","flag","tickets","watch","value","forEach","item","passengerId","id","passengerName","name","passengerType","type","passengerIdCard","idCard","seatTypeCode","immediate","seatTypes","KEY","key","toLowerCase","desc","count","price","handleQuerypassenger","then","success","label","columns","title","dataIndex","chooseSeatCode","SEAT_COL","computed","SEAT_COL_ARRAY","filter","chooseSeatObj","i","onConfirm","length","seatTempTypes","Tool","copy","Type","setTimeout","seatTypeCodes","seatTypeDistinct","Array","from","Set","YDZ","EDZ","info","showCode","loadImgCode","handleOk","validateFields","seat","confirmOrder","start","trainCode","end","dailyTrainTicketId","post","msg","onClose","onMounted","validateCode","async","_rule","resolve","rules","required","validator","trigger","uuid","__exports__"],"sourceRoot":""}